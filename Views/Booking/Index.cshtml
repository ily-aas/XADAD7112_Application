@{
    ViewData["Title"] = "Book Your Appointment";
}

<div class="booking-banner text-white d-flex flex-column justify-content-end align-items-center">
    <h2>BOOK AN APPOINTMENT</h2>
    <p>Build your own quote and secure your booking</p>
</div>


<div class="container py-5">

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4" id="bookingTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="nails-tab" data-bs-toggle="tab" data-bs-target="#nails" type="button" role="tab">Nails</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="massage-tab" data-bs-toggle="tab" data-bs-target="#massage" type="button" role="tab">Massage</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="facial-tab" data-bs-toggle="tab" data-bs-target="#facial" type="button" role="tab">Facial</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="lashes-tab" data-bs-toggle="tab" data-bs-target="#lashes" type="button" role="tab">Lashes</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="package-tab" data-bs-toggle="tab" data-bs-target="#package" type="button" role="tab">Packages</button>
        </li>
    </ul>

    <!-- Tab content -->
    <div class="tab-content" id="bookingTabContent">
        <div class="tab-pane fade show active" id="nails" role="tabpanel">
            <div class="row" id="nails-products"></div>
        </div>
        <div class="tab-pane fade" id="massage" role="tabpanel">
            <div class="row" id="massage-products"></div>
        </div>
        <div class="tab-pane fade" id="facial" role="tabpanel">
            <div class="row" id="facial-products"></div>
        </div>
        <div class="tab-pane fade" id="lashes" role="tabpanel">
            <div class="row" id="lashes-products"></div>
        </div>
        <div class="tab-pane fade" id="package" role="tabpanel">
            <div class="row" id="package-products"></div>
        </div>
    </div>

    <!-- Cart -->
    <div class="mt-5">
        <h3>Cart</h3>
        <ul class="list-group" id="cart-items"></ul>
        <h4 class="mt-3">Total: R<span id="cart-total">0</span></h4>
        <form method="post" asp-controller="Booking" asp-action="SubmitBooking">
            <input type="hidden" name="Total" id="TotalInput" />
            <button type="submit" class="btn btn-primary btn-lg mt-3">Submit Booking</button>
        </form>


    </div>
</div>

<script>
    // Sample treatments
    const products = {
        nails: [
            { name: "Basic Manicure", price: 200 },
            { name: "Gel Manicure", price: 350 },
            { name: "Pedicure", price: 250 }
        ],
        massage: [
            { name: "Swedish Massage", price: 500 },
            { name: "Deep Tissue Massage", price: 650 }
        ],
        facial: [
            { name: "Basic Facial", price: 400 },
            { name: "Luxury Facial", price: 700 }
        ],
        lashes: [
            { name: "Classic Lashes", price: 450 },
            { name: "Volume Lashes", price: 700 }
        ],
        package: [
            { name: "Basic", price: 250 },
            { name: "Premium", price: 550 },
             { name: "Luxury", price: 1200 }
        ]
    };

    // Store user selections
    const cart = {};
    let total = 0;

    // Render products in tabs
    function renderProducts(tab) {
        const container = document.getElementById(tab + "-products");
        container.innerHTML = "";
        products[tab].forEach((p, idx) => {
            const itemId = `${tab}-${idx}`;
            const selected = cart[itemId] ? cart[itemId].quantity : 0;

            const col = document.createElement("div");
            col.className = "col-md-4 mb-3";
            col.innerHTML = `
                <div class="card p-3">
                    <h5>${p.name}</h5>
                    <p>R${p.price}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <button class="btn btn-sm btn-danger" onclick="decrement('${tab}', ${idx})">-</button>
                        <span id="qty-${itemId}">${selected}</span>
                        <button class="btn btn-sm btn-success" onclick="increment('${tab}', ${idx})">+</button>
                    </div>
                </div>
            `;
            container.appendChild(col);
        });
    }

    // Increment item
    function increment(tab, idx) {
        const id = `${tab}-${idx}`;
        const p = products[tab][idx];
        if (!cart[id]) cart[id] = { ...p, quantity: 0 };
        cart[id].quantity++;
        updateCart();
    }

    // Decrement item
    function decrement(tab, idx) {
        const id = `${tab}-${idx}`;
        if (!cart[id]) return;
        cart[id].quantity--;
        if (cart[id].quantity <= 0) delete cart[id];
        updateCart();
    }

    // Update cart UI and total
    function updateCart() {
        const cartList = document.getElementById("cart-items");
        cartList.innerHTML = "";
        total = 0;
        Object.keys(cart).forEach(key => {
            const item = cart[key];
            total += item.price * item.quantity;
            const li = document.createElement("li");
            li.className = "list-group-item d-flex justify-content-between align-items-center";
            li.innerHTML = `${item.name} x${item.quantity} <span>R${item.price * item.quantity}</span>`;
            cartList.appendChild(li);

            // Update quantity display in product card
            const qtySpan = document.getElementById("qty-" + key);
            if (qtySpan) qtySpan.innerText = item.quantity;
        });
        document.getElementById("cart-total").innerText = total;
    }

        function updateCart() {
        const cartList = document.getElementById("cart-items");
        cartList.innerHTML = "";
        total = 0;
        let index = 0;

        Object.keys(cart).forEach(key => {
            const item = cart[key];
            total += item.price * item.quantity;

            const li = document.createElement("li");
            li.className = "list-group-item d-flex justify-content-between align-items-center";
            li.innerHTML = `
                ${item.name} x${item.quantity} <span>R${item.price * item.quantity}</span>

                <input type="hidden" name="Items[${index}].Name" value="${item.name}">
                <input type="hidden" name="Items[${index}].Price" value="${item.price}">
                <input type="hidden" name="Items[${index}].Quantity" value="${item.quantity}">
            `;
            cartList.appendChild(li);

            index++;
        });

        document.getElementById("cart-total").innerText = total;
        document.getElementById("TotalInput").value = total;
    }


    // Initialize tabs on page load
    ["nails","massage","facial","lashes"].forEach(renderProducts);
</script>